Version 4
SHEET 1 7000 2176
WIRE 1760 -928 1648 -928
WIRE -32 -896 -112 -896
WIRE 1648 -896 1648 -928
WIRE -544 -880 -592 -880
WIRE -432 -880 -464 -880
WIRE -368 -880 -432 -880
WIRE -224 -880 -288 -880
WIRE 176 -880 96 -880
WIRE 336 -880 256 -880
WIRE 1056 -880 1056 -928
WIRE -112 -864 -112 -896
WIRE 2016 -864 1984 -864
WIRE 2176 -864 2096 -864
WIRE -32 -848 -32 -896
WIRE 16 -848 -32 -848
WIRE 96 -848 96 -880
WIRE 1792 -800 1760 -928
WIRE 1840 -800 1792 -800
WIRE 1984 -800 1984 -864
WIRE 1984 -800 1920 -800
WIRE 1056 -784 1056 -800
WIRE 1056 -784 928 -784
WIRE -112 -752 -112 -784
WIRE 928 -752 928 -784
WIRE 1648 -752 1648 -816
WIRE 1056 -736 1056 -784
WIRE 96 -720 96 -848
WIRE 176 -720 96 -720
WIRE 1984 -720 1984 -800
WIRE 2016 -720 1984 -720
WIRE -432 -704 -432 -880
WIRE -368 -704 -432 -704
WIRE 336 -704 336 -880
WIRE 336 -704 240 -704
WIRE 400 -704 336 -704
WIRE 2176 -704 2176 -864
WIRE 2176 -704 2080 -704
WIRE 2240 -704 2176 -704
WIRE -224 -688 -224 -880
WIRE -224 -688 -304 -688
WIRE -48 -688 -224 -688
WIRE 64 -688 32 -688
WIRE 176 -688 64 -688
WIRE 1696 -688 1648 -688
WIRE 1952 -688 1776 -688
WIRE 2016 -688 1952 -688
WIRE -368 -672 -432 -672
WIRE -544 -640 -592 -640
WIRE -432 -640 -432 -672
WIRE -432 -640 -464 -640
WIRE 1952 -640 1952 -688
WIRE 1056 -608 1056 -656
WIRE -432 -592 -432 -640
WIRE 64 -592 64 -688
WIRE 1952 -496 1952 -560
WIRE 64 -480 64 -512
WIRE -432 -464 -432 -512
WIRE -128 -48 -224 -48
WIRE 32 -48 -48 -48
WIRE 704 -48 560 -48
WIRE 864 -48 704 -48
WIRE 992 -48 864 -48
WIRE 1232 -48 1088 -48
WIRE 1296 -48 1232 -48
WIRE 1520 -48 1376 -48
WIRE 1568 -48 1520 -48
WIRE 1696 -48 1632 -48
WIRE 1728 -48 1696 -48
WIRE 1840 -48 1808 -48
WIRE 1984 -48 1840 -48
WIRE 560 -16 560 -48
WIRE 1984 -16 1984 -48
WIRE 704 16 704 -48
WIRE 864 16 864 -48
WIRE 144 32 112 32
WIRE 1232 32 1232 -48
WIRE 1696 32 1696 -48
WIRE 1840 32 1840 -48
WIRE -576 48 -720 48
WIRE -384 48 -496 48
WIRE -224 48 -224 -48
WIRE -128 48 -224 48
WIRE 32 48 32 -48
WIRE 32 48 -64 48
WIRE 1520 48 1520 -48
WIRE 560 112 560 64
WIRE 864 144 864 96
WIRE 1072 144 1072 0
WIRE 1072 144 864 144
WIRE -720 176 -720 48
WIRE -560 176 -720 176
WIRE 112 176 112 32
WIRE 176 176 112 176
WIRE -384 192 -384 48
WIRE -384 192 -496 192
WIRE -352 192 -384 192
WIRE -224 192 -224 48
WIRE -224 192 -272 192
WIRE -128 192 -224 192
WIRE 352 192 240 192
WIRE 496 192 432 192
WIRE 864 192 864 144
WIRE 1984 192 1984 144
WIRE -560 208 -592 208
WIRE 32 208 32 48
WIRE 32 208 -64 208
WIRE 176 208 32 208
WIRE -384 224 -384 192
WIRE -128 224 -192 224
WIRE 1232 224 1232 96
WIRE 1520 224 1520 112
WIRE -80 240 -96 240
WIRE 704 240 704 96
WIRE 800 240 704 240
WIRE -720 256 -720 176
WIRE 704 256 704 240
WIRE -192 288 -192 224
WIRE -96 288 -96 240
WIRE 496 304 496 192
WIRE 640 304 496 304
WIRE 656 304 640 304
WIRE -592 320 -592 208
WIRE -384 320 -384 304
WIRE -384 320 -592 320
WIRE -384 368 -384 320
WIRE -720 416 -720 320
WIRE 704 432 704 352
WIRE 864 464 864 288
WIRE -384 480 -384 448
WIRE -192 480 -192 368
WIRE 736 1264 736 1184
WIRE 864 1264 736 1264
WIRE 1040 1264 864 1264
WIRE 1312 1264 1040 1264
WIRE 864 1328 864 1264
WIRE 1088 1328 1088 1184
WIRE 1040 1344 1040 1264
WIRE 1360 1344 1360 1184
WIRE 736 1360 736 1264
WIRE 1312 1360 1312 1264
WIRE 736 1504 736 1424
WIRE 864 1504 864 1408
WIRE 864 1504 736 1504
WIRE 1040 1504 1040 1392
WIRE 1040 1504 864 1504
WIRE 1312 1504 1312 1408
WIRE 1312 1504 1040 1504
WIRE 128 1520 -80 1520
WIRE 320 1536 192 1536
WIRE 1088 1536 1088 1408
WIRE 1232 1536 1088 1536
WIRE 1360 1536 1360 1424
WIRE 1360 1536 1232 1536
WIRE 128 1552 48 1552
WIRE -80 1568 -80 1520
WIRE 320 1568 320 1536
WIRE 48 1584 48 1552
WIRE 112 1584 48 1584
WIRE 112 1632 112 1584
WIRE 736 1632 736 1504
WIRE 1232 1632 1232 1536
WIRE 320 1680 320 1648
WIRE 480 1680 320 1680
WIRE 672 1680 560 1680
WIRE -80 1696 -80 1648
WIRE 320 1696 320 1680
WIRE 48 1728 48 1584
WIRE 112 1760 112 1696
WIRE 320 1824 320 1776
WIRE 736 1824 736 1728
FLAG -384 480 0
FLAG -720 416 0
FLAG -192 480 0
FLAG 928 -752 0
FLAG 1056 -928 +Vcc
IOPIN 1056 -928 Out
FLAG 1056 -608 -Vcc
IOPIN 1056 -608 Out
FLAG -432 -464 0
FLAG 64 -480 0
FLAG -112 -752 0
FLAG -336 -720 +Vcc
IOPIN -336 -720 In
FLAG -336 -656 -Vcc
IOPIN -336 -656 In
FLAG 208 -736 +Vcc
IOPIN 208 -736 In
FLAG 208 -672 -Vcc
IOPIN 208 -672 In
FLAG 1952 -496 0
FLAG 1648 -752 0
FLAG -96 288 -Vcc
IOPIN -96 288 In
FLAG -96 176 +Vcc
IOPIN -96 176 In
FLAG 208 160 +Vcc
IOPIN 208 160 In
FLAG -528 160 +Vcc
IOPIN -528 160 In
FLAG -528 224 -Vcc
IOPIN -528 224 In
FLAG 208 224 -Vcc
IOPIN 208 224 In
FLAG 2048 -736 +Vcc
IOPIN 2048 -736 BiDir
FLAG 2048 -672 -Vcc
IOPIN 2048 -672 BiDir
FLAG 560 112 0
FLAG 1360 1184 Vol_Control
IOPIN 1360 1184 BiDir
FLAG 1088 1184 Curr_Control
IOPIN 1088 1184 BiDir
FLAG 1232 1632 PWM_Control
IOPIN 1232 1632 BiDir
FLAG 736 1824 0
FLAG 736 1184 +Vcc
IOPIN 736 1184 BiDir
FLAG 48 1728 Battery
IOPIN 48 1728 BiDir
FLAG 160 1568 +Vcc
IOPIN 160 1568 BiDir
FLAG -80 1696 0
FLAG 1984 192 0
FLAG 1984 -48 Battery
IOPIN 1984 -48 BiDir
FLAG 320 1824 0
FLAG 1520 224 0
FLAG 1696 32 Current_sence1
IOPIN 1696 32 BiDir
FLAG 1840 32 Current_sence2
IOPIN 1840 32 BiDir
FLAG -592 -640 Current_sence1
IOPIN -592 -640 BiDir
FLAG -592 -880 Current_sence2
IOPIN -592 -880 BiDir
FLAG 1648 -688 Battery
IOPIN 1648 -688 BiDir
FLAG 144 32 PWM_Control
IOPIN 144 32 BiDir
FLAG 2240 -704 Vol_Control
IOPIN 2240 -704 BiDir
FLAG 400 -704 Curr_Control
IOPIN 400 -704 BiDir
FLAG 1232 224 0
FLAG 864 464 0
FLAG 704 432 0
FLAG 160 1504 -Vcc
IOPIN 160 1504 BiDir
FLAG 112 1760 0
SYMBOL res -400 208 R0
SYMATTR InstName R1
SYMATTR Value 33k
SYMBOL res -400 352 R0
SYMATTR InstName R2
SYMATTR Value 33k
SYMBOL cap -736 256 R0
SYMATTR InstName C1
SYMATTR Value 10n
SYMBOL res -480 32 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R3
SYMATTR Value 33k
SYMBOL cap -64 32 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName C2
SYMATTR Value 10n
SYMBOL res -32 -64 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R5
SYMATTR Value 33k
SYMBOL res -208 272 R0
WINDOW 0 -42 67 Left 2
WINDOW 3 -57 33 Left 2
SYMATTR InstName R6
SYMATTR Value 100k
SYMBOL OpAmps\\RH27C -96 144 R0
SYMATTR InstName U3
SYMBOL OpAmps\\RH27C -528 128 R0
SYMATTR InstName U5
SYMBOL OpAmps\\RH27C 208 128 R0
SYMATTR InstName U6
SYMBOL voltage 1056 -896 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V6
SYMATTR Value 15v
SYMBOL voltage 1056 -752 R0
SYMATTR InstName V7
SYMATTR Value 15v
SYMBOL res -448 -656 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R11
SYMATTR Value 10k
SYMBOL res -448 -608 R0
SYMATTR InstName R14
SYMATTR Value 20k
SYMBOL OpAmps\\RH27C -336 -752 R0
SYMATTR InstName U7
SYMBOL res -448 -896 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R10
SYMATTR Value 10k
SYMBOL res -272 -896 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R12
SYMATTR Value 20k
SYMBOL OpAmps\\RH27C 208 -768 R0
SYMATTR InstName U8
SYMBOL res 48 -704 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R13
SYMATTR Value 220
SYMBOL res 48 -608 R0
SYMATTR InstName R15
SYMATTR Value 5k
SYMBOL res 112 -864 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R16
SYMATTR Value 220
SYMBOL res 272 -896 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R17
SYMATTR Value 5k
SYMBOL voltage -112 -880 R0
SYMATTR InstName V5
SYMATTR Value 2v
SYMBOL OpAmps\\RH27C 2048 -768 R0
SYMATTR InstName U10
SYMBOL res 1792 -704 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R18
SYMATTR Value 1k
SYMBOL res 1936 -816 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R19
SYMATTR Value 1k
SYMBOL res 1936 -656 R0
SYMATTR InstName R20
SYMATTR Value 1k
SYMBOL res 2112 -880 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R21
SYMATTR Value 1k
SYMBOL voltage 1648 -912 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V8
SYMATTR Value 13.6V
SYMBOL nmos 992 0 R270
SYMATTR InstName M2
SYMATTR Value FDS4410
SYMBOL res 1968 -32 R0
SYMATTR InstName R22
SYMATTR Value 1
SYMBOL voltage 560 -32 R0
SYMATTR InstName V10
SYMATTR Value 30V
SYMBOL sw 1088 1424 M180
SYMATTR InstName S1
SYMATTR Value NO
SYMBOL sw 1360 1440 M180
SYMATTR InstName S2
SYMATTR Value NC
SYMBOL res 848 1312 R0
SYMATTR InstName R23
SYMATTR Value 10k
SYMBOL diode 752 1424 R180
WINDOW 0 24 64 Left 2
WINDOW 3 24 0 Left 2
SYMATTR InstName D1
SYMBOL npn 672 1632 R0
SYMATTR InstName Q1
SYMBOL voltage -80 1552 R0
SYMATTR InstName V11
SYMATTR Value 13.3V
SYMBOL voltage 1984 48 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
WINDOW 3 -273 106 Left 0
SYMATTR Value PWL(0 2V 100ms 4V 200ms 6V 300ms 8V 400ms 10V 500ms 11V 600ms 11.5V 700ms 12V 800ms 12.5V 900ms 13V 1000ms 13.5V 1010ms 13.9V 1020ms 14V)
SYMATTR InstName V12
SYMBOL res 304 1552 R0
SYMATTR InstName R26
SYMATTR Value 10k
SYMBOL res 304 1680 R0
SYMATTR InstName R27
SYMATTR Value 10k
SYMBOL OpAmps\\OP747 160 1600 M180
SYMATTR InstName U1
SYMBOL ind 1280 -32 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 5 56 VBottom 2
SYMATTR InstName L1
SYMATTR Value 200m
SYMBOL cap 1504 48 R0
SYMATTR InstName C3
SYMATTR Value 100µ
SYMBOL res 1712 -32 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 0 56 VBottom 2
SYMATTR InstName R28
SYMATTR Value 1
SYMBOL schottky 1568 -32 R270
WINDOW 0 32 32 VTop 2
WINDOW 3 0 32 VBottom 2
SYMATTR InstName D2
SYMATTR Value 30BQ060
SYMATTR Description Diode
SYMATTR Type diode
SYMBOL schottky 1248 96 R180
WINDOW 0 24 64 Left 2
WINDOW 3 24 0 Left 2
SYMATTR InstName D8
SYMATTR Value MBR735
SYMATTR Description Diode
SYMATTR Type diode
SYMBOL npn 800 192 R0
SYMATTR InstName Q5
SYMBOL res 448 176 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R9
SYMATTR Value 1k
SYMBOL res 848 0 R0
SYMATTR InstName R29
SYMATTR Value 1.2k
SYMBOL npn 640 256 R0
SYMATTR InstName Q2
SYMBOL res 688 0 R0
SYMATTR InstName R8
SYMATTR Value 1.2k
SYMBOL res 576 1664 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R7
SYMATTR Value 1k
SYMBOL cap 96 1632 R0
SYMATTR InstName C4
SYMATTR Value 10µ
SYMBOL res -256 176 R90
WINDOW 0 -3 86 VBottom 2
WINDOW 3 -27 20 VTop 2
SYMATTR InstName R4k
SYMATTR Value 2.2k
TEXT 320 -624 Left 2 !.tran 1s
TEXT -272 -160 Left 2 ;PWM Generator
TEXT -240 -1000 Left 2 ;constant current control
TEXT 1776 -1024 Left 2 ;constant voltage control
TEXT 112 336 Left 2 ;Duty cycle controling
TEXT 40 368 Left 2 ;If the voltage is increased here, \nduty cycle will decrease\nand vise versa
TEXT 136 1304 Left 2 !.model NO SW(Ron=1 Roff=10Meg Vt=5V )
TEXT 136 1344 Left 2 !.model NC SW(Ron=100Meg Roff=1 Vt=5V)
TEXT 1008 -1128 Left 2 ;Power
TEXT 1272 -216 Left 2 ;Buck Converter
TEXT 504 856 Left 2 ;Switching circuit
RECTANGLE Normal 1360 -416 752 -1088 2
RECTANGLE Normal 2448 -432 1488 -976 2
RECTANGLE Normal 624 -416 -848 -960 2
RECTANGLE Normal 448 528 -784 -128 2
RECTANGLE Normal 2288 544 496 -160 2
RECTANGLE Normal -192 2096 1504 912 2
